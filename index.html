<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SmartVendo — TTS, TTI & Chat</title>
<style>
  :root{--accent:#007bff;--bg:#f5f9ff}
  body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Poppins",sans-serif;margin:0;background:linear-gradient(135deg,#eaf6ff,#fbfdff);padding:28px}
  .wrap{max-width:1100px;margin:0 auto}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  header h1{color:var(--accent);margin:0;font-size:1.2rem}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 28px rgba(10,20,40,.06)}
  label{display:block;margin-top:8px;margin-bottom:6px;font-weight:600;font-size:0.95rem}
  textarea,input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6edf6;font-size:0.95rem}
  .row{display:flex;gap:8px;align-items:center}
  .btn{background:var(--accent);color:#fff;border:none;padding:9px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn.secondary{background:#f2f5fb;color:#222}
  .out{margin-top:10px}
  .loader{width:34px;height:34px;border-radius:50%;border:4px solid #eef2f7;border-top-color:var(--accent);animation:spin .9s linear infinite;display:inline-block}
  @keyframes spin{to{transform:rotate(360deg)}}
  .media{display:flex;flex-direction:column;gap:8px}
  audio{width:100%}
  img.thumb{max-width:100%;border-radius:8px;border:1px solid #edf5ff}
  .chat-area{height:300px;overflow:auto;border-radius:8px;padding:8px;border:1px solid #eef5ff;background:#fbfdff}
  .msg{padding:8px;border-radius:8px;margin:8px 0;max-width:85%}
  .msg.user{background:#e6f2ff;margin-left:auto;color:#033}
  .msg.bot{background:#f2f5fb;color:#033}
  .controls{display:flex;gap:8px;align-items:center;margin-top:10px}
  footer{margin-top:18px;text-align:center;color:#666}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>SmartVendo — TTS · TTI · Chat</h1>
    <div id="workerUrlPreview" style="color:#666;font-size:0.9rem">Backend: not set</div>
  </header>

  <div class="grid">
    <!-- TTS -->
    <section class="card" aria-label="Text to Speech">
      <h3>TTS — Text → Speech</h3>
      <label for="ttsText">Text</label>
      <textarea id="ttsText" rows="5">Welcome to SmartVendo — demo voice.</textarea>

      <div class="row" style="margin-top:8px">
        <div style="flex:1">
          <label for="voiceSelect">Voice</label>
          <select id="voiceSelect">
            <option>Soft Female</option>
            <option>Strong Female</option>
            <option>African Female</option>
            <option>UK Female</option>
            <option>US Female</option>
            <option>Young Male</option>
            <option>Deep Male</option>
            <option>African Male</option>
            <option>Robotic</option>
            <option>Narrator</option>
          </select>
        </div>
        <div style="width:120px">
          <label for="speed">Speed</label>
          <select id="speed"><option value="0.8">Slow</option><option value="1" selected>Normal</option><option value="1.25">Fast</option></select>
        </div>
      </div>

      <div class="controls">
        <button id="genTtsBtn" class="btn">Generate</button>
        <button id="stopTtsBtn" class="btn secondary">Stop</button>
        <div id="ttsSpinner" style="margin-left:auto;display:none"><span class="loader"></span></div>
      </div>

      <div id="ttsOut" class="out"></div>
    </section>

    <!-- TTI -->
    <section class="card" aria-label="Text to Image">
      <h3>TTI — Text → Image</h3>
      <label for="imgPrompt">Prompt</label>
      <textarea id="imgPrompt" rows="4">A minimal flat-lay of coffee and notebook, soft morning lighting.</textarea>

      <label for="styleSel">Style</label>
      <select id="styleSel"><option value="photorealistic">Photorealistic</option><option value="digital-painting">Digital painting</option><option value="vector">Vector / flat</option></select>

      <label for="sizeSel">Size</label>
      <select id="sizeSel"><option value="512">512×512</option><option value="768">768×768</option><option value="1024">1024×1024</option></select>

      <div class="controls">
        <button id="genImgBtn" class="btn">Generate Image</button>
        <button id="clearImgBtn" class="btn secondary">Clear</button>
        <div id="imgSpinner" style="margin-left:auto;display:none"><span class="loader"></span></div>
      </div>

      <div id="imgOut" class="out"></div>
    </section>
  </div>

  <!-- Chat -->
  <div style="margin-top:14px" class="card">
    <h3>Chatbot</h3>
    <div id="chatArea" class="chat-area"></div>

    <div style="display:flex;gap:8px;margin-top:8px">
      <input id="chatInput" placeholder="Type your message..." style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6edf6"/>
      <button id="sendChatBtn" class="btn">Send</button>
    </div>
  </div>

  <footer> @ ForgeAIHub 2025. All rights reserved </footer>
</div>

<script>
/* ====== CONFIG — set this to your deployed Node.js backend URL ====== */
const WORKER_BASE_URL = "https://smartvendo-backend.onrender.com"; // <-- replace with your backend URL
document.getElementById('workerUrlPreview').textContent = WORKER_BASE_URL;

/* ====== HELPERS ====== */
function show(el, yes=true){ el.style.display = yes ? '' : 'none'; }
function blobToUrl(blob){ return URL.createObjectURL(blob); }

/* ====== TTS ====== */
const genTtsBtn = document.getElementById('genTtsBtn');
const ttsText = document.getElementById('ttsText');
const ttsOut = document.getElementById('ttsOut');
const ttsSpinner = document.getElementById('ttsSpinner');
const stopTtsBtn = document.getElementById('stopTtsBtn');
let activeAudio = null;

genTtsBtn.addEventListener('click', async () => {
  const text = ttsText.value.trim();
  if(!text){ alert('Enter text'); return; }
  show(ttsSpinner,true);
  ttsOut.innerHTML='';

  try {
    const resp = await fetch(`${WORKER_BASE_URL}/tts`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        text,
        voice: document.getElementById('voiceSelect').value,
        speed: document.getElementById('speed').value
      })
    });
    if(!resp.ok){ const t=await resp.text(); ttsOut.innerHTML=`<div style="color:#b00">Error: ${t}</div>`; return; }
    const blob = await resp.blob();
    const url = blobToUrl(blob);
    const audio = document.createElement('audio');
    audio.controls = true;
    audio.src = url;
    audio.autoplay = true;
    ttsOut.appendChild(audio);

    const dl = document.createElement('button');
    dl.className='btn secondary';
    dl.textContent='Download audio';
    dl.onclick=()=>{ const a=document.createElement('a'); a.href=url; a.download='speech.wav'; a.click(); };
    ttsOut.appendChild(dl);

    activeAudio=audio;
  } catch(err){
    ttsOut.innerHTML=`<div style="color:#b00">Network error: ${err.message}</div>`;
  } finally { show(ttsSpinner,false); }
});

stopTtsBtn.addEventListener('click', ()=>{ if(activeAudio){ activeAudio.pause(); activeAudio.currentTime=0; } });

/* ====== TTI ====== */
const genImgBtn=document.getElementById('genImgBtn');
const imgPrompt=document.getElementById('imgPrompt');
const imgOut=document.getElementById('imgOut');
const imgSpinner=document.getElementById('imgSpinner');

genImgBtn.addEventListener('click', async ()=>{
  const prompt=imgPrompt.value.trim();
  if(!prompt){ alert('Enter prompt'); return; }
  show(imgSpinner,true);
  imgOut.innerHTML='';

  try{
    const r=await fetch(`${WORKER_BASE_URL}/tti`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        prompt,
        style: document.getElementById('styleSel').value,
        size: document.getElementById('sizeSel').value
      })
    });
    if(!r.ok){ const t=await r.text(); imgOut.innerHTML=`<div style="color:#b00">Error: ${t}</div>`; return; }
    const blob=await r.blob();
    const url=blobToUrl(blob);
    const img=document.createElement('img');
    img.className='thumb';
    img.src=url;
    imgOut.appendChild(img);

    const dl=document.createElement('button');
    dl.className='btn secondary';
    dl.textContent='Download image';
    dl.onclick=()=>{ const a=document.createElement('a'); a.href=url; a.download='image.png'; a.click(); };
    imgOut.appendChild(dl);
  } catch(err){ imgOut.innerHTML=`<div style="color:#b00">Network error: ${err.message}</div>`; }
  finally{ show(imgSpinner,false); }
});

document.getElementById('clearImgBtn').addEventListener('click', ()=>{ imgPrompt.value=''; imgOut.innerHTML=''; });

/* ====== CHATBOT ====== */
const chatArea=document.getElementById('chatArea');
const chatInput=document.getElementById('chatInput');
const sendChatBtn=document.getElementById('sendChatBtn');

function addMsg(txt,who='bot'){
  const d=document.createElement('div');
  d.className='msg '+(who==='user'?'user':'bot');
  d.textContent=txt;
  chatArea.appendChild(d);
  chatArea.scrollTop=chatArea.scrollHeight;
}

sendChatBtn.addEventListener('click', async ()=>{
  const text=chatInput.value.trim();
  if(!text) return;
  addMsg(text,'user');
  chatInput.value='';
  const spinner=document.createElement('div'); spinner.className='msg bot'; spinner.textContent='...';
  chatArea.appendChild(spinner);
  chatArea.scrollTop=chatArea.scrollHeight;

  try{
    const r=await fetch(`${WORKER_BASE_URL}/chat`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({text})
    });
    if(!r.ok){ const t=await r.text(); spinner.textContent='Error: '+t; return; }
    const j=await r.json();
    spinner.remove();
    addMsg(j.reply||j.result||'No reply','bot');
  } catch(err){ spinner.textContent='Network error: '+err.message; }
});

/* quick ping */
(async function ping(){
  try{
    const r=await fetch(`${WORKER_BASE_URL}/ping`);
    console.log('ping',r.status);
  } catch(e){ console.warn('Backend ping failed',e.message); }
})();
</script>
</body>
</html>
